function boostrapMods(){$("[rel=tooltip]").tooltip(),$("[rel=popover]").popover(),$("[rel=popover]").click(function(e){e.preventDefault()}),$("[rel=popover][data-trigger=hover]").off("click"),$(".dropdown").on("show.bs.dropdown",function(){$(this).find(".dropdown-menu").first().stop(!0,!0).slideDown(100)}),$(".dropdown").on("hide.bs.dropdown",function(){$(this).find(".dropdown-menu").first().stop(!0,!0).slideUp(100)}),$(".dropdown-toggle").click(function(e){e.preventDefault()})}function bindComments(){var e="#comment_frame",t=$(e);$(".step-body .comment, #sharing_lightbox .comment").each(function(){var i=$(this),n=$(this).parent().parent().parent().parent(),o=$(this).parent().parent().parent();return o.is(".hideable-inner")?($(this).remove(),!0):("sharing_lightbox"!=n.attr("id")&&$(this).html(getTemplate("_comment_icon")),void $(this).find("a").on("touchstart, click",function(o){if(o.preventDefault(),stopEventPropagating(o),!$("#comment_frame").hasClass("animated")){i.append(loadingIndicator);var a,r,s="";if("sharing_lightbox"==n.attr("id"))s="/comments/image-get/"+n.attr("data-id"),a=-160,r="auto";else{var d=window.location.href.substr(window.location.href.lastIndexOf("/")+1);d=d.split("#")[0],d=d.split("?")[0],s="/comments/get/"+d+"/"+$(this).parent().attr("data-group"),a=32,r=-64}$.ajax({url:s,success:function(n){n.success&&(t.html(n.html),showCommentFrame(e,t,i,a,r)),i.children().last().remove()},timeout:3e3,dataType:"json",error:function(){t.html("Could not load comments."),showCommentFrame(e,t,i,a,r),i.children().last().remove()}})}}))}),$("html").on("touchstart, click",function(i){eventTargetDoesNotInclude(i,"#comment_frame")&&(t.hasClass("animated")||"block"!=t.css("display")||animate(e,"fadeOutUp",function(){t.css("display","none")}))})}function showCommentFrame(e,t,i,n,o){var a="auto"==o;n||(n=32),o||(o=-64),t.css("display","block"),t.offset("ExtraSmall"==findBootstrapEnvironment()?{left:getViewportWidth()/2-t.outerWidth()/2,top:i.offset().top+o}:i.offset().left+n+t.outerWidth()>=getViewportWidth()?{left:getViewportWidth()-t.outerWidth()-10,top:i.offset().top+o}:{left:i.offset().left+n,top:i.offset().top+o}),animate(e,"fadeInDown",null),$("form#Comment").off(),$("form#Comment").ajaxForm({beforeSubmit:function(){t.find(".errors").text(""),$("form#Comment").find('input[type="submit"]').attr("disabled","disabled")},success:function(e){e.success?t.html(e.html):appendErrors(e.errors,t,".errors"),$("form#Comment").find('input[type="submit"]').attr("disabled",!1)},error:function(){t.find(".errors").append("Could not post comment, try again?"),$("form#Comment").find('input[type="submit"]').attr("disabled",!1)}}),a&&t.offset({top:i.offset().top-t.height()-32}),$(".js-close-comments").click(function(i){i.preventDefault(),animate(e,"fadeOutUp",function(){t.css("display","none")})}),$(".js-delete-comment").bind("click",function(e){if(e.preventDefault(),confirm("Delete this comment?")){var t=$(this).parent().parent();$.get($(this).attr("href")).done(function(e){e.success&&t.remove()}).fail(function(){})}}),$(".js-report-comment").bind("click",function(e){e.preventDefault(),confirm("Report this comment?")&&$.get($(this).attr("href")).done(function(e){alert(e.success?"Comment reported, thanks!":"Comment already reported.")}).fail(function(){})})}function bindDefinitions(){$("a[rel='definition']").click(function(e){var t=$(this);e.preventDefault();var i=$(this).attr("data-query");t.after(loadingIndicator),$.ajax({url:"/definitions/define/"+i,success:function(e){if("null"!=e&&null!=e){$(".step-body .js-inserted-definition").remove();var i=format(getTemplate("_inserted_definition"),{"definition-title":e.title,"definition-body":marked(e.body),"definition-id":marked(e._id)});t.parent().after(i),animate(t.parent().next(),"fadeInUp"),MathJax.Hub.Queue(["Typeset",MathJax.Hub,t.parent().next()[0]]),$(".js-close-inserted-definition").click(function(e){e.preventDefault(),animate($(this).parent(),"fadeOutDown",function(e){e.remove()})})}t.next().remove()},timeout:3e3,dataType:"json",error:function(){t.next().remove(),console.log("Could not load definition.")}})}),$(".js-insert-definition").click(function(e){e.preventDefault();var t="{definition{TITLE, TERM}}";prompt("Macro:",t),editor.focus()}),$(".js-insert-inline-definition").click(function(e){e.preventDefault();var t="{inline-definition{TERM}}";prompt("Macro:",t),editor.focus()}),$(".js-insert-inline-tex").click(function(e){e.preventDefault();var t="\\\\( \\\\)";prompt("Tex:",t),editor.focus()}),$(".js-insert-block-tex").click(function(e){e.preventDefault();var t="\\\\[ \\\\]";prompt("Tex:",t),editor.focus()})}function bindEpicEditorFields(){if(defined("EpicEditor")&&$("#epiceditor-target").length>0){var e={textarea:"epiceditor-target",basePath:"/javascripts/epiceditor/",clientSideStorage:!1,localStorageName:"epiceditor",useNativeFullscreen:!0,parser:marked,file:{name:"epiceditor",defaultContent:"",autoSave:100},theme:{base:"themes/base/epiceditor.css",preview:"themes/preview/github.css",editor:"themes/editor/epic-dark.css"},focusOnLoad:!1,string:{togglePreview:"Toggle Preview Mode",toggleEdit:"Toggle Edit Mode",toggleFullscreen:"Enter Fullscreen"},autogrow:!0,minHeight:512};editor=new EpicEditor(e).load(),$("#epiceditor-target").parent().hide()}}function appendErrors(e,t,i){for(var n in e){if(Array.isArray(e[n]))for(var o=0;o<e[n].length;o++)t.find(i).append(e[n][o]),t.find(i).append("<br>");else t.find(i).append(e[n]),t.find(i).append("<br>");animate(i,"fadeInUp")}}function createHideableRegions(){$(".hideable-inner").each(function(){$(this).find(".content").hide()}),$(".js-toggle-hideable").click(function(e){e.preventDefault();var t=$(this).parent().find(".content");isVisible(t)?($(this).text("Expand"),animateElement(t,"fadeOutDown",function(e){e.hide()})):($(this).text("Hide"),t.css("display","block"),animateElement(t,"fadeInUp"))})}function bindInsertRegionButton(){$(".js-insert-hideable").click(function(e){e.preventDefault();var t="{hideable{TITLE, CONTENT}}";prompt("Macro:",t),editor.focus()})}function setUpBannerImage(){$(".banner-image").each(function(){var e=$(this),t=e.attr("data-background");t&&""!=t&&"#"!=t[0]?e.css("background-image","url("+t+")"):t&&""!=t&&e.css("background-color",t)}),$("[data-bg]").each(function(){$(this).css("background-color",$(this).attr("data-bg"))}),$("[data-colour]").each(function(){$(this).css("color",$(this).attr("data-colour"))}),jQuery().lazyload&&$(".step-body img").lazyload({threshold:200,load:lazyLoadHandler})}function lazyLoadHandler(){$(this).attr("data-zoominit")||$(this).attr("data-zoominit",!0).wrap('<div class="zoom-wrapper" style="width:'+$(this).innerWidth()+'px;"></div>').parent().zoom({on:"mouseover",magnify:1.5})}function updateProgressBars(){if($(".progress-list-wrapper .progress").each(function(){var e=($(this),$(this).parent()),t=e.find("ul.progress-list li:first a"),i=e.find("ul.progress-list li.current-step a");$(this).css("width",i.offset().left-t.offset().left),$(this).css("left",t.position().left+2),$(this).css("top",t.position().top)}),$(".course-progress-node").length>0){var e=getVerticalProgressPoints(),t=e.first,i=e.upto,n=e.last;nodeWidth=t.outerWidth()-3;var o=$(".vertical-progress-done");o.css("height",i.offset().top-t.offset().top),o.css("left",t.offset().left+nodeWidth/2),o.css("top",t.offset().top+nodeWidth/2);var a=$(".vertical-progress-todo");a.css("height",n.offset().top-i.offset().top),a.css("left",i.offset().left+nodeWidth/2),a.css("top",i.offset().top+nodeWidth/2)}}function getVerticalProgressPoints(){var e=$(".course-progress-node.first"),t=$(".course-progress-node.done:last"),i=$(".course-progress-node.last");return 0==t.length&&(t=e),{first:e,upto:t,last:i}}function initVerticalBars(){if($(".course-progress-node").length>0){$("body").prepend("<div class='vertical-progress-done'></div>"),$("body").prepend("<div class='vertical-progress-todo'></div>");var e=$(".course-progress-node").not(".done").first().parent().next(),t=e.find("a").attr("href");e.find(".box").prepend("<a href='"+t+"' class='button create-button float-right lets-go'>Let's Go!</div>")}}function bindProgressBarResize(){updateProgressBars(),$(window).resize(updateProgressBars)}function bindSharingImageForm(){$sharedImageForm.ajaxForm({beforeSubmit:function(){$sharedImageForm.find(".errors").text(""),$sharedImageForm.find('input[type="submit"]').attr("disabled","disabled")},success:function(e){e.success?e.refresh&&location.reload(!0):appendErrors(e.errors,$sharedImageForm,".errors"),$sharedImageForm.find('input[type="submit"]').attr("disabled",!1)},error:function(){$sharedImageForm.find(".errors").append("Could not share image, try again?"),$sharedImageForm.find('input[type="submit"]').attr("disabled",!1)}})}function bindPageResize(){updateProgressBars(),$(window).resize(updateLearnGrid)}function updateLearnGrid(){$(".shared-image-holder").each(function(){$(this).css("height",$(this).css("width"))}),resizeLightboxImage()}function hideLightbox(){animate("#sharing_lightbox","fadeOutUp",function(){$("#sharing_lightbox").css("display","none")}),animate("#sharing_lightbox_overlay","fadeOutUpHalfOpacity",function(){$("#sharing_lightbox_overlay").css("display","none")})}function showLightbox(e){$currentLightboxSource=e,$("#sharing_lightbox").css("display","block"),$("#sharing_lightbox_overlay").css("display","block"),$("#sharing_lightbox img").attr("src",e.attr("src")),$("#sharing_lightbox .download-link").attr("href",e.attr("src")),$("#sharing_lightbox").attr("data-id",e.attr("data-id")),$("#sharing_lightbox .description p").text(e.attr("data-description")),animate("#sharing_lightbox","fadeInDown",null),resizeLightboxImage(),$("#sharing_lightbox img").off(),$("#sharing_lightbox img").load(resizeLightboxImage)}function resizeLightboxImage(){if($("#sharing_lightbox img").attr("style",null),$("#sharing_lightbox img").height()>$("#sharing_lightbox .image-frame").height()){var e=$("#sharing_lightbox .image-frame").height()/$("#sharing_lightbox img").height();$("#sharing_lightbox img").height($("#sharing_lightbox .image-frame").height()),$("#sharing_lightbox img").width($("#sharing_lightbox img").width()*e)}}function showNextImage(){var e=$currentLightboxSource.parent().parent().next().find(".shared-image-holder img");e.length>0&&showLightbox(e)}function showPrevImage(){var e=$currentLightboxSource.parent().parent().prev().find(".shared-image-holder img");e.length>0&&showLightbox(e)}function bindSlugFields(){$(".js-slug").keyup(function(){var e="#"+$(this).attr("data-object")+"_"+$(this).attr("data-target");$(e).val(convertToSlug($(this).val()))})}function bindLowercaseFields(){$(".js-lowercase").keyup(function(){var e="#"+$(this).attr("data-object")+"_"+$(this).attr("data-target");$(e).val(convertToLowercase($(this).val()))})}function bindSortableLists(){jQuery().sortable&&($(".js-sortable").off(),$(".js-sortable-delete-link").off(),$(".js-sortable-add-new").off(),$(".js-sortable").sortable(),$(".js-sortable-delete-link").bind("click",function(e){e.preventDefault(),$(this).parent().remove()}),$(".js-sortable-add-new").click(function(e){var t=$($(this).attr("data-read-selection-from")),i=$(this).attr("data-hidden-field-name"),n=$($(this).attr("data-target-list"));e.preventDefault(),n.append(format(getTemplate("_lesson_list_entry"),{"item-text":t.find("option:selected").text(),"field-name":i,"field-value":t.val()})),bindSortableLists()}))}function bindUpload(){var e="#upload_frame",t=$(e);$(".js-upload-link").click(function(i){i.preventDefault(),stopEventPropagating(i),t.hasClass("animated")||$.ajax({url:"/upload/",success:function(i){i.success&&(t.html(i.html),showUploadFrame(e,t))},timeout:1e3,dataType:"json",error:function(){t.html("Could not load upload form."),showUploadFrame(e,t)}})}),$("html").click(function(i){eventTargetDoesNotInclude(i,"#upload_frame")&&(t.hasClass("animated")||"block"!=t.css("display")||animate(e,"fadeOutUp",function(){t.css("display","none")}))})}function showUploadFrame(e,t){t.css("display","block"),t.offset({left:$(".js-upload-link").offset().left,top:$(".js-upload-link").offset().top+40}),animate(e,"fadeInDown",null),$("form#Upload").off(),$("form#Upload").ajaxForm({beforeSubmit:function(){t.find(".errors").text(""),t.find(".file").text(""),$("form#Upload").find('input[type="submit"]').attr("disabled","disabled")},success:function(e){e.success?(t.find(".file").html("<a href='"+e.file+"'>View File</a>&nbsp;<a class='js-copy-link' href='"+e.file+"'>Get Link</a>"),t.find(".js-copy-link").click(function(e){e.preventDefault(),window.prompt("Copy to clipboard: Ctrl/Cmd+C, Enter",$(this).attr("href"))})):appendErrors(e.errors,t,".errors"),$("form#Upload").find('input[type="submit"]').attr("disabled",!1)},error:function(){t.find(".errors").append("Could not post comment, try again?"),$("form#Upload").find('input[type="submit"]').attr("disabled",!1)}})}function defined(e){return"undefined"!=typeof window[e]}function convertToSlug(e){return e.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")}function convertToLowercase(e){return e.toLowerCase()}function supportsTransitions(){var e=document.body||document.documentElement,t=e.style,i="transition";if("string"==typeof t[i])return!0;var n=["Moz","webkit","Webkit","Khtml","O","ms"];i=i.charAt(0).toUpperCase()+i.substr(1);for(var o=0;o<n.length;o++)if("string"==typeof t[n[o]+i])return!0;return!1}function isVisible(e){return"none"!=e.css("display")&&"hidden"!=e.css("display")?!0:!1}function insertTextAtCursor(e){var t,i;window.getSelection?(t=window.getSelection(),t.getRangeAt&&t.rangeCount&&(i=t.getRangeAt(0),i.deleteContents(),i.insertNode(document.createTextNode(e)))):document.selection&&document.selection.createRange&&(document.selection.createRange().text=e)}function saveSelection(){if(window.getSelection){if(sel=window.getSelection(),sel.getRangeAt&&sel.rangeCount)return sel.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null}function restoreSelection(e){e&&(window.getSelection?(sel=window.getSelection(),sel.removeAllRanges(),sel.addRange(e)):document.selection&&e.select&&e.select())}function findBootstrapEnvironment(){var e=["ExtraSmall","Small","Medium","Large"],t=["xs","sm","md","lg"],i=$("<div>");i.appendTo($("body"));for(var n=t.length-1;n>=0;n--){var o=t[n];if(i.addClass("hidden-"+o),i.is(":hidden"))return i.remove(),e[n]}}function getViewportWidth(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)}function getViewportHeight(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)}function animate(e,t,i){animateElement($(e),t,i)}function animateElement(e,t,i){if(supportsTransitions()){e.attr("data-timeout-id")&&window.clearTimeout(e.attr("data-timeout-id")),e.addClass(t),e.addClass("animated");var n=window.setTimeout(function(){e.removeClass(t),e.removeClass("animated"),null!=i&&i(e)},2e3);e.attr("data-timeout-id",n),e.off(),e.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){e.removeClass(t),e.removeClass("animated"),null!=i&&i(e)})}else i(e)}function stopEventPropagating(e){e||(e=window.event),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function eventTargetDoesNotInclude(e,t){return 0==$(e.target).closest(t).length}function getTemplate(e){return $("#"+e+"_template").html()}function format(e,t){for(var i in t){var n=new RegExp("{{#"+i+"}}","g");e=e.replace(n,t[i])}return e}$(function(){$("html").first().removeClass("no-js"),defined("Select2")&&$(".js-select2").select2(),jQuery().lazyload&&$("img.lazy").lazyload({threshold:200}),$(".step-body a[rel='definition']").each(function(){$(this).html($(this).html()+' <i class="fa fa-book"></i>'),"undefined"==typeof $(this).attr("title")&&$(this).attr("title","Show Definition"),$(this).tooltip()}),$(".step-body .comment a").tooltip(),$(".step-body a[href*='http']").each(function(){$(this).html($(this).html()+' <i class="fa fa-external-link"></i>'),"undefined"==typeof $(this).attr("title")&&$(this).attr("title",$(this).attr("href")),$(this).attr("target","new"),$(this).tooltip()}),($("div:contains('$$')").length>0||$("div:contains('\\(')").length>0)&&!function(){var e,t=document.getElementsByTagName("head")[0];e=document.createElement("script"),e.type="text/x-mathjax-config",e[window.opera?"innerHTML":"text"]='MathJax.Hub.Config({\n  jax: ["input/TeX","output/SVG"]});',t.appendChild(e),e=document.createElement("script"),e.type="text/javascript",e.src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML",t.appendChild(e)}()}),boostrapMods(),bindComments(),bindDefinitions();var editor;bindEpicEditorFields(),createHideableRegions(),bindInsertRegionButton(),setUpBannerImage();var loadingIndicator='<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>';bindProgressBarResize(),initVerticalBars();var $sharedImageForm=$("form#addSharedImageForm");bindSharingImageForm(),bindPageResize(),updateLearnGrid();var sharingLightboxId="#sharing_lightbox",$sharingLightbox=$(sharingLightboxId);$(".js-close-lightbox").click(function(){hideLightbox()}),$("html").click(function(e){eventTargetDoesNotInclude(e,sharingLightboxId)&&eventTargetDoesNotInclude(e,"#comment_frame")&&($sharingLightbox.hasClass("animated")||"block"!=$sharingLightbox.css("display")||hideLightbox())});var $currentLightboxSource;$("img.lazy.shared-image").click(function(){console.log("test"),showLightbox($(this)),animate("#sharing_lightbox_overlay","fadeInDownHalfOpacity",null)}),$("#shared_image_shared_image").change(function(){this.files[0].size/1048576>2?$sharedImageForm.find(".errors").append("This file is too large (bigger than 2MB), try compressing or resizing it."):$sharedImageForm.ajaxSubmit({url:"/upload-image/",type:"post",beforeSubmit:function(){$sharedImageForm.find(".errors").text(""),$sharedImageForm.find('input[type="submit"]').attr("disabled","disabled")},success:function(e){e.success?($("#shared_image_url").val(e.file),$("#shared_image_preview").attr("src",e.file)):appendErrors(e.errors,$sharedImageForm,".errors"),$sharedImageForm.find('input[type="submit"]').attr("disabled",!1)},error:function(){$sharedImageForm.find(".errors").append("Could not share image, try again?"),$sharedImageForm.find('input[type="submit"]').attr("disabled",!1)}})}),document.onkeydown=function(e){e=e||window.event;var t="number"==typeof e.which?e.which:e.keyCode;$("#sharing_lightbox").is(":visible")&&(37==t&&showPrevImage(),39==t&&showNextImage())},bindSlugFields(),bindLowercaseFields(),bindSortableLists(),bindUpload();