function boostrapMods(){$("[rel=tooltip]").tooltip(),$("[rel=popover]").popover(),$("[rel=popover]").click(function(e){e.preventDefault()}),$("[rel=popover][data-trigger=hover]").off("click"),$(".dropdown").on("show.bs.dropdown",function(){$(this).find(".dropdown-menu").first().stop(!0,!0).slideDown(100)}),$(".dropdown").on("hide.bs.dropdown",function(){$(this).find(".dropdown-menu").first().stop(!0,!0).slideUp(100)})}function bindComments(){var e="#comment_frame",t=$(e);$(".step-body .comment").each(function(){var n=$(this);$(this).html(getTemplate("_comment_icon")),$(this).find("a").click(function(o){if(o.preventDefault(),stopEventPropagating(o),!$("#comment_frame").hasClass("animated")){var i=window.location.href.substr(window.location.href.lastIndexOf("/")+1);i=i.split("#")[0],i=i.split("?")[0],$.ajax({url:"/comments/get/"+i+"/"+$(this).parent().attr("data-group"),success:function(o){o.success&&(t.html(o.html),showCommentFrame(e,t,n))},timeout:1e3,dataType:"json",error:function(){t.html("Could not load comments."),showCommentFrame(e,t,n)}})}})}),$("html").click(function(n){eventTargetDoesNotInclude(n,"#comment_frame")&&(t.hasClass("animated")||"block"!=t.css("display")||animate(e,"fadeOutUp",function(){t.css("display","none")}))})}function showCommentFrame(e,t,n){t.css("display","block"),t.offset({left:n.offset().left+32,top:n.offset().top-64}),animate(e,"fadeInDown",null),$("form#Comment").off(),$("form#Comment").ajaxForm({beforeSubmit:function(){t.find(".errors").text(""),$("form#Comment").find('input[type="submit"]').attr("disabled","disabled")},success:function(e){if(e.success)t.html(e.html);else for(var n in e.errors)t.find(".errors").append(e.errors[n]),animate(".errors","fadeInUp");$("form#Comment").find('input[type="submit"]').attr("disabled",!1)},error:function(){t.find(".errors").append("Could not post comment, try again?"),$("form#Comment").find('input[type="submit"]').attr("disabled",!1)}}),$(".js-close-comments").click(function(n){n.preventDefault(),animate(e,"fadeOutUp",function(){t.css("display","none")})}),$(".js-delete-comment").bind("click",function(e){if(e.preventDefault(),confirm("Delete this comment?")){var t=$(this).parent().parent();$.get($(this).attr("href")).done(function(e){e.success&&t.remove()}).fail(function(){})}}),$(".js-report-comment").bind("click",function(e){e.preventDefault(),confirm("Report this comment?")&&$.get($(this).attr("href")).done(function(e){alert(e.success?"Comment reported, thanks!":"Comment already reported.")}).fail(function(){})})}function bindEpicEditorFields(){if(defined("EpicEditor")&&$("#epiceditor-target").length>0){{var e={textarea:"epiceditor-target",basePath:"/javascripts/epiceditor/",clientSideStorage:!0,localStorageName:"epiceditor",useNativeFullscreen:!0,parser:marked,file:{name:"epiceditor",defaultContent:"",autoSave:100},theme:{base:"themes/base/epiceditor.css",preview:"themes/preview/github.css",editor:"themes/editor/epic-dark.css"},focusOnLoad:!1,string:{togglePreview:"Toggle Preview Mode",toggleEdit:"Toggle Edit Mode",toggleFullscreen:"Enter Fullscreen"},autogrow:!1};new EpicEditor(e).load()}$("#epiceditor-target").parent().hide()}}function setUpBannerImage(){$(".banner-image").each(function(){var e=$(this);e.attr("data-background")&&""!=e.attr("data-background")&&e.css("background-image","url("+e.attr("data-background")+")")})}function updateProgressBars(){$(".progress-list-wrapper .progress").each(function(){var e=($(this),$(this).parent()),t=e.find("ul.progress-list li:first a"),n=e.find("ul.progress-list li.current-step a");$(this).css("width",n.offset().left-t.offset().left),$(this).css("left",t.position().left+2),$(this).css("top",t.position().top)})}function bindProgressBarResize(){updateProgressBars(),$(window).resize(updateProgressBars)}function bindSharingImageForm(){var e=$("form#addSharedImageForm");e.ajaxForm({beforeSubmit:function(){e.find(".errors").text(""),e.find('input[type="submit"]').attr("disabled","disabled")},success:function(t){if(t.success)t.refresh&&location.reload(!0);else for(var n in t.errors)e.find(".errors").append(t.errors[n]),animate(".errors","fadeInUp");e.find('input[type="submit"]').attr("disabled",!1)},error:function(){e.find(".errors").append("Could not share image, try again?"),e.find('input[type="submit"]').attr("disabled",!1)}})}function bindPageResize(){updateProgressBars(),$(window).resize(updateLearnGrid)}function updateLearnGrid(){$(".shared-image-holder").each(function(){$(this).css("height",$(this).css("width"))})}function bindSlugFields(){$(".js-slug").keyup(function(){var e="#"+$(this).attr("data-object")+"_"+$(this).attr("data-target");$(e).val(convertToSlug($(this).val()))})}function bindSortableLists(){jQuery().sortable&&($(".js-sortable").off(),$(".js-sortable-delete-link").off(),$(".js-sortable-add-new").off(),$(".js-sortable").sortable(),$(".js-sortable-delete-link").bind("click",function(e){e.preventDefault(),$(this).parent().remove()}),$(".js-sortable-add-new").click(function(e){var t=$($(this).attr("data-read-selection-from")),n=$(this).attr("data-hidden-field-name"),o=$($(this).attr("data-target-list"));e.preventDefault(),o.append(format(getTemplate("_lesson_list_entry"),{"item-text":t.find("option:selected").text(),"field-name":n,"field-value":t.val()})),bindSortableLists()}))}function bindUpload(){var e="#upload_frame",t=$(e);$(".js-upload-link").click(function(n){n.preventDefault(),stopEventPropagating(n),t.hasClass("animated")||$.ajax({url:"/upload/",success:function(n){n.success&&(t.html(n.html),showUploadFrame(e,t))},timeout:1e3,dataType:"json",error:function(){t.html("Could not load upload form."),showUploadFrame(e,t)}})}),$("html").click(function(n){eventTargetDoesNotInclude(n,"#upload_frame")&&(t.hasClass("animated")||"block"!=t.css("display")||animate(e,"fadeOutUp",function(){t.css("display","none")}))})}function showUploadFrame(e,t){t.css("display","block"),t.offset({left:$(".js-upload-link").offset().left,top:$(".js-upload-link").offset().top+40}),animate(e,"fadeInDown",null),$("form#Upload").off(),$("form#Upload").ajaxForm({beforeSubmit:function(){t.find(".errors").text(""),t.find(".file").text(""),$("form#Upload").find('input[type="submit"]').attr("disabled","disabled")},success:function(e){if(e.success)console.log(e),t.find(".file").html("<a href='"+e.file+"'>View File</a>&nbsp;<a class='js-copy-link' href='"+e.file+"'>Get Link</a>"),t.find(".js-copy-link").click(function(e){e.preventDefault(),window.prompt("Copy to clipboard: Ctrl/Cmd+C, Enter",$(this).attr("href"))});else for(var n in e.errors)t.find(".errors").append(e.errors[n]),animate(".errors","fadeInUp");$("form#Upload").find('input[type="submit"]').attr("disabled",!1)},error:function(){t.find(".errors").append("Could not post comment, try again?"),$("form#Upload").find('input[type="submit"]').attr("disabled",!1)}})}function animate(e,t,n){$(e).attr("data-timeout-id")&&window.clearTimeout($(e).attr("data-timeout-id")),$(e).addClass(t),$(e).addClass("animated");var o=window.setTimeout(function(){$(e).removeClass(t),$(e).removeClass("animated"),null!=n&&n()},2e3);$(e).attr("data-timeout-id",o),$(e).off(),$(e).one("animationend webkitAnimationEnd oAnimationEnd MSAnimationEnd",function(){$(e).removeClass(t),$(e).removeClass("animated"),null!=n&&n()})}function stopEventPropagating(e){e||(e=window.event),e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function eventTargetDoesNotInclude(e,t){return 0==$(e.target).closest(t).length}function getTemplate(e){return $("#"+e+"_template").html()}function format(e,t){for(var n in t){var o=new RegExp("{{#"+n+"}}","g");e=e.replace(o,t[n])}return e}function defined(e){return"undefined"!=typeof window[e]}function convertToSlug(e){return e.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")}$(function(){FastClick.attach(document.body),defined("Select2")&&$(".js-select2").select2()}),boostrapMods(),bindComments(),bindEpicEditorFields(),setUpBannerImage(),bindProgressBarResize(),bindSharingImageForm(),bindPageResize(),updateLearnGrid(),$("img.lazy").lazyload(),$("img.lazy").click(function(){$("#sharing_lightbox").css("display","block"),$("#sharing_lightbox img").attr("src","http://www.appelsiini.net/projects/lazyload/img/bmw_m1_hood.jpg"),animate("#sharing_lightbox","fadeInDown",null)}),bindSlugFields(),bindSortableLists(),bindUpload();