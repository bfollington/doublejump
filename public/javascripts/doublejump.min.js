function boostrapMods(){$("[rel=tooltip]").tooltip(),$("[rel=popover]").popover(),$("[rel=popover]").click(function(t){t.preventDefault()}),$("[rel=popover][data-trigger=hover]").off("click"),$(".dropdown").on("show.bs.dropdown",function(){$(this).find(".dropdown-menu").first().stop(!0,!0).slideDown(100)}),$(".dropdown").on("hide.bs.dropdown",function(){$(this).find(".dropdown-menu").first().stop(!0,!0).slideUp(100)}),$(".dropdown-toggle").click(function(t){t.preventDefault()})}function bindEpicEditorFields(){if(defined("EpicEditor")&&$("#epiceditor-target").length>0){var t={textarea:"epiceditor-target",basePath:"/javascripts/epiceditor/",clientSideStorage:!1,localStorageName:"epiceditor",useNativeFullscreen:!0,parser:marked,file:{name:"epiceditor",defaultContent:"",autoSave:100},theme:{base:"themes/base/epiceditor.css",preview:"themes/preview/github.css",editor:"themes/editor/epic-dark.css"},focusOnLoad:!1,string:{togglePreview:"Toggle Preview Mode",toggleEdit:"Toggle Edit Mode",toggleFullscreen:"Enter Fullscreen"},autogrow:!0,minHeight:512};editor=new EpicEditor(t).load(),$("#epiceditor-target").parent().hide()}}function appendErrors(t,e,n){for(var i in t){if(Array.isArray(t[i]))for(var o=0;o<t[i].length;o++)e.find(n).append(t[i][o]),e.find(n).append("<br>");else e.find(n).append(t[i]),e.find(n).append("<br>");animate(n,"fadeInUp")}}function bindSortableLists(){jQuery().sortable&&($(".js-sortable").off(),$(".js-sortable-delete-link").off(),$(".js-sortable-add-new").off(),$(".js-sortable").sortable(),$(".js-sortable-delete-link").bind("click",function(t){t.preventDefault(),$(this).parent().remove()}),$(".js-sortable-add-new").click(function(t){var e=$($(this).attr("data-read-selection-from")),n=$(this).attr("data-hidden-field-name"),i=$($(this).attr("data-target-list"));t.preventDefault(),i.append(format(getTemplate("_lesson_list_entry"),{"item-text":e.find("option:selected").text(),"field-name":n,"field-value":e.val()})),bindSortableLists()}))}function bindUpload(){var t="#upload_frame",e=$(t);$(".js-upload-link").click(function(n){n.preventDefault(),stopEventPropagating(n),e.hasClass("animated")||$.ajax({url:"/upload/",success:function(n){n.success&&(e.html(n.html),showUploadFrame(t,e))},timeout:1e3,dataType:"json",error:function(){e.html("Could not load upload form."),showUploadFrame(t,e)}})}),$("html").click(function(n){eventTargetDoesNotInclude(n,"#upload_frame")&&(e.hasClass("animated")||"block"!=e.css("display")||animate(t,"fadeOutUp",function(){e.css("display","none")}))})}function showUploadFrame(t,e){e.css("display","block"),e.offset({left:$(".js-upload-link").offset().left,top:$(".js-upload-link").offset().top+40}),animate(t,"fadeInDown",null),$("form#Upload").off(),$("form#Upload").ajaxForm({beforeSubmit:function(){e.find(".errors").text(""),e.find(".file").text(""),$("form#Upload").find('input[type="submit"]').attr("disabled","disabled")},success:function(t){t.success?(e.find(".file").html("<a href='"+t.file+"'>View File</a>&nbsp;<a class='js-copy-link' href='"+t.file+"'>Get Link</a>"),e.find(".js-copy-link").click(function(t){t.preventDefault(),window.prompt("Copy to clipboard: Ctrl/Cmd+C, Enter",$(this).attr("href"))})):appendErrors(t.errors,e,".errors"),$("form#Upload").find('input[type="submit"]').attr("disabled",!1)},error:function(){e.find(".errors").append("Could not post comment, try again?"),$("form#Upload").find('input[type="submit"]').attr("disabled",!1)}})}function defined(t){return"undefined"!=typeof window[t]}function convertToSlug(t){return t.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")}function convertToLowercase(t){return t.toLowerCase()}function supportsTransitions(){var t=document.body||document.documentElement,e=t.style,n="transition";if("string"==typeof e[n])return!0;var i=["Moz","webkit","Webkit","Khtml","O","ms"];n=n.charAt(0).toUpperCase()+n.substr(1);for(var o=0;o<i.length;o++)if("string"==typeof e[i[o]+n])return!0;return!1}function isVisible(t){return"none"!=t.css("display")&&"hidden"!=t.css("display")?!0:!1}function insertTextAtCursor(t){var e,n;window.getSelection?(e=window.getSelection(),e.getRangeAt&&e.rangeCount&&(n=e.getRangeAt(0),n.deleteContents(),n.insertNode(document.createTextNode(t)))):document.selection&&document.selection.createRange&&(document.selection.createRange().text=t)}function saveSelection(){if(window.getSelection){if(sel=window.getSelection(),sel.getRangeAt&&sel.rangeCount)return sel.getRangeAt(0)}else if(document.selection&&document.selection.createRange)return document.selection.createRange();return null}function restoreSelection(t){t&&(window.getSelection?(sel=window.getSelection(),sel.removeAllRanges(),sel.addRange(t)):document.selection&&t.select&&t.select())}function findBootstrapEnvironment(){var t=["ExtraSmall","Small","Medium","Large"],e=["xs","sm","md","lg"],n=$("<div>");n.appendTo($("body"));for(var i=e.length-1;i>=0;i--){var o=e[i];if(n.addClass("hidden-"+o),n.is(":hidden"))return n.remove(),t[i]}}function getViewportWidth(){return Math.max(document.documentElement.clientWidth,window.innerWidth||0)}function getViewportHeight(){return Math.max(document.documentElement.clientHeight,window.innerHeight||0)}function animate(t,e,n){animateElement($(t),e,n)}function animateElement(t,e,n){if(supportsTransitions()){t.attr("data-timeout-id")&&window.clearTimeout(t.attr("data-timeout-id")),t.addClass(e),t.addClass("animated");var i=window.setTimeout(function(){t.removeClass(e),t.removeClass("animated"),null!=n&&n(t)},2e3);t.attr("data-timeout-id",i),t.off(),t.one("webkitAnimationEnd mozAnimationEnd MSAnimationEnd oanimationend animationend",function(){t.removeClass(e),t.removeClass("animated"),t.trigger("animationOver"),null!=n&&n(t)})}else n(t)}function stopEventPropagating(t){t||(t=window.event),t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}function eventTargetDoesNotInclude(t,e){return 0==$(t.target).closest(e).length}function getTemplate(t){return $("#"+t+"_template").html()}function format(t,e){for(var n in e){var i=new RegExp("{{#"+n+"}}","g");t=t.replace(i,e[n])}return t}var mathjax=!1;$(function(){$("html").first().removeClass("no-js"),defined("Select2")&&$(".js-select2").select2(),jQuery().lazyload&&$("img.lazy").lazyload({threshold:200}),$(".step-body a[rel='definition']").each(function(){$(this).html($(this).html()+' <i class="fa fa-book"></i>'),"undefined"==typeof $(this).attr("title")&&$(this).attr("title","Show Definition"),$(this).tooltip()}),$(".step-body .comment a").tooltip(),$(".step-body a[href*='http']").each(function(){$(this).html($(this).html()+' <i class="fa fa-external-link"></i>'),"undefined"==typeof $(this).attr("title")&&$(this).attr("title",$(this).attr("href").trunc(50)),$(this).attr("target","new"),$(this).tooltip({placement:"top"})}),($("div:contains('{\\[')").length>0||$("div:contains('\\(')").length>0)&&(mathjax=!0,function(){var t,e=document.getElementsByTagName("head")[0];t=document.createElement("script"),t.type="text/x-mathjax-config",t[window.opera?"innerHTML":"text"]="MathJax.Hub.Config({\n});",e.appendChild(t),t=document.createElement("script"),t.type="text/javascript",t.src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML",e.appendChild(t)}())}),boostrapMods();var comments=new function(){var t=this;t.bindComments=function(){var e="#comment_frame",n=$(e);$(".step-body .comment, .shared-wrapper .comment").each(function(){{var i=$(this),o=$(this).parent().parent().parent().parent(),r=$(this).parent().parent().parent();$(this).prev()}if(r.is(".hideable-inner"))return $(this).remove(),!0;0==$(this).closest(".shared-wrapper").length&&$(this).html(format(getTemplate("_comment_icon"),{"comment-count":$(this).attr("data-count")})),$(this).find("a").on("touchstart, click",function(r){if(r.preventDefault(),stopEventPropagating(r),!$("#comment_frame").hasClass("animated")){i.append(loadingIndicator);var a,s,d="";if("sharing_lightbox"==o.attr("id"))d="/comments/image-get/"+o.attr("data-id"),a=-160,s="auto";else{var c=window.location.href.substr(window.location.href.lastIndexOf("/")+1);c=c.split("#")[0],c=c.split("?")[0],d="/comments/get/"+c+"/"+$(this).parent().attr("data-group"),a=32,s=-64}$.ajax({url:d,success:function(o){o.success&&(n.html(o.html),t.showCommentFrame(e,n,i,a,s)),i.children().last().remove()},timeout:3e3,dataType:"json",error:function(){n.html("Could not load comments."),t.showCommentFrame(e,n,i,a,s),i.children().last().remove()}})}})}),$(".step-body :not(div) + p .comment").each(function(){$(this).prependTo($(this).parent())});var i=$(".step-body .comment").first();i.prependTo(i.parent()),$(".step-body div + p .comment").each(function(){$(this).parent().insertBefore($(this).parent().prev())}),$("html").on("touchstart, click",function(t){eventTargetDoesNotInclude(t,"#comment_frame")&&(n.hasClass("animated")||"block"!=n.css("display")||animate(e,"fadeOutUp",function(){n.css("display","none")}))})},t.showCommentFrame=function(t,e,n,i,o){var r="auto"==o;i||(i=32),o||(o=-64),e.css("display","block"),e.offset("ExtraSmall"==findBootstrapEnvironment()?{left:getViewportWidth()/2-e.outerWidth()/2,top:n.offset().top+o}:n.offset().left+i+e.outerWidth()>=getViewportWidth()?{left:getViewportWidth()-e.outerWidth()-10,top:n.offset().top+o}:{left:n.offset().left+i,top:n.offset().top+o}),animate(t,"fadeInDown",null),$("form#Comment").off(),$("form#Comment").ajaxForm({beforeSubmit:function(){e.find(".errors").text(""),$("form#Comment").find('input[type="submit"]').attr("disabled","disabled")},success:function(t){t.success?e.html(t.html):appendErrors(t.errors,e,".errors"),$("form#Comment").find('input[type="submit"]').attr("disabled",!1)},error:function(){e.find(".errors").append("Could not post comment, try again?"),$("form#Comment").find('input[type="submit"]').attr("disabled",!1)}}),r&&e.offset({top:n.offset().top-e.height()-32}),$(".js-close-comments").click(function(n){n.preventDefault(),animate(t,"fadeOutUp",function(){e.css("display","none")})}),$(".js-delete-comment").bind("click",function(t){if(t.preventDefault(),confirm("Delete this comment?")){var e=$(this).parent().parent();$.get($(this).attr("href")).done(function(t){t.success&&e.remove()}).fail(function(){})}}),$(".js-report-comment").bind("click",function(t){t.preventDefault(),confirm("Report this comment?")&&$.get($(this).attr("href")).done(function(t){alert(t.success?"Comment reported, thanks!":"Comment already reported.")}).fail(function(){})})}};comments.bindComments();var definitions=new function(){var t=this;t.bindDefinitions=function(){$("a[rel='definition']").click(function(t){var e=$(this);t.preventDefault();var n=$(this).attr("data-query");e.after(loadingIndicator),$.ajax({url:"/definitions/define/"+n,success:function(t){if("null"!=t&&null!=t){$(".step-body .js-inserted-definition").remove();var n=format(getTemplate("_inserted_definition"),{"definition-title":t.title,"definition-body":marked(t.body),"definition-id":t._id});e.parent().after(n),animate(e.parent().next(),"fadeInUp"),mathjax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub,e.parent().next()[0]]),$(".js-close-inserted-definition").click(function(t){t.preventDefault(),animate($(this).parent(),"fadeOutDown",function(t){t.remove()})})}e.next().remove()},timeout:3e3,dataType:"json",error:function(){e.next().remove(),console.log("Could not load definition.")}})}),$(".js-insert-definition").click(function(t){t.preventDefault();var e='{definition{"TITLE", "TERM"}}';prompt("Macro:",e),editor.focus()}),$(".js-insert-inline-definition").click(function(t){t.preventDefault();var e='{inline-definition{"TERM"}}';prompt("Macro:",e),editor.focus()}),$(".js-insert-inline-tex").click(function(t){t.preventDefault();var e="\\\\( \\\\)";prompt("Tex:",e),editor.focus()}),$(".js-insert-block-tex").click(function(t){t.preventDefault();var e="\\\\[ \\\\]";prompt("Tex:",e),editor.focus()}),$(".js-insert-two-cols").click(function(t){t.preventDefault();var e='{two-columns{"one", "two"}}';prompt("Macro:",e),editor.focus()}),$(".js-insert-one-col").click(function(t){t.preventDefault();var e='{one-column{"content"}}';prompt("Macro:",e),editor.focus()})}};definitions.bindDefinitions();var editor;bindEpicEditorFields();var hideable=new function(){var t=this;t.createHideableRegions=function(){$(".hideable-inner").each(function(){$(this).find(".content").hide()}),$(".js-toggle-hideable").click(function(t){t.preventDefault();var e=$(this).parent().find(".content");isVisible(e)?($(this).text("Expand"),animateElement(e,"fadeOutDown",function(t){t.hide()})):($(this).text("Hide"),e.css("display","block"),animateElement(e,"fadeInUp"))})},t.bindInsertRegionButton=function(){$(".js-insert-hideable").click(function(t){t.preventDefault();var e="{hideable{TITLE, CONTENT}}";prompt("Macro:",e),editor.focus()})}};hideable.createHideableRegions(),hideable.bindInsertRegionButton();var landing=new function(){this.init=function(){$(".landing-page-tab").click(function(t){t.preventDefault();var e=parseInt($(this).attr("data-target"));console.log(e);var n=$(".landing-page-box");n.removeClass("visible"),$(n[e]).addClass("visible")})}},learn=new function(){var t=this;t.setup=function(){$(".banner-image").each(function(){var t=$(this),e=t.attr("data-background");e&&""!=e&&"#"!=e[0]?t.css("background-image","url("+e+")"):e&&""!=e&&t.css("background-color",e)}),$("[data-bg]").each(function(){$(this).css("background-color",$(this).attr("data-bg"))}),$("[data-colour]").each(function(){$(this).css("color",$(this).attr("data-colour"))}),jQuery().lazyload?$(".step-body img").lazyload({threshold:200,load:t.lazyLoadHandler}):$(".step-body img").each(function(){$(this).attr("src",$(this).attr("data-original"))})},t.lazyLoadHandler=function(){$(this).attr("data-caption",$(this).attr("alt")),$(this).addClass("plus-cursor"),Intense(this)}};learn.setup();var loadingIndicator='<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>',notifications=new function(){var t=this;t.bindRemoveLinks=function(){$(".remove-notification").click(function(t){t.preventDefault(),t.stopPropagation();var e=$(this).closest(".dropdown-menu");console.log(e);var n=$(this).closest("li");$.postWithCsrf("/notifications/remove/"+n.attr("data-id"),{},function(t){t.success||console.error("Notification "+n.attr("data-id")+" could not be removed.")}),n.remove(),$(".notification-badge").text(parseInt($(".notification-badge").text())-1),0==e.children().length&&(e.remove(),$(".notifications").remove())})}};notifications.bindRemoveLinks();var paymentValidation=new function(){this.init=function(){function t(t,e){var n=$("#editAccountSettingsForm");if(e.error)n.find(".payment-errors").text(e.error.message),n.find("button").prop("disabled",!1);else{var i=e.id;n.append($('<input type="hidden" name="stripeToken" />').val(i)),n.get(0).submit()}}return"undefined"==typeof Stripe||"undefined"==typeof jQuery.payment?void console.error("Payment Validation has a hard dependency on the Stripe API and the jQuery Payment Plugin."):(Stripe.setPublishableKey("#{stripe_publishable_key}"),$("#cc_num").payment("formatCardNumber"),$("#cc_cvc").payment("formatCardCVC"),$("#cc_expire").payment("formatCardExpiry"),$("#cc_expire").keyup(function(){var t=$(this).payment("cardExpiryVal");$("#cc_exp_month").val(t.month),$("#cc_exp_year").val(t.year)}),void $("#editAccountSettingsForm").submit(function(){var e=$(this);return e.find("button").prop("disabled",!0),Stripe.card.createToken(e,t),!1}))}},progress=new function(){var t=this;t.updateProgressBars=function(){if($(".progress-list-wrapper .progress").each(function(){var t=($(this),$(this).parent()),e=t.find("ul.progress-list li:first a"),n=t.find("ul.progress-list li.current-step a");$(this).css("width",n.offset().left-e.offset().left),$(this).css("left",e.position().left+2),$(this).css("top",e.position().top)}),$(".course-progress-node").length>0){var e=t.getVerticalProgressPoints(),n=e.first,i=e.upto,o=e.last;nodeWidth=n.outerWidth()-3;var r=$(".vertical-progress-done");r.css("height",i.offset().top-n.offset().top),r.css("left",n.offset().left+nodeWidth/2),r.css("top",n.offset().top+nodeWidth/2);var a=$(".vertical-progress-todo");a.css("height",o.offset().top-i.offset().top),a.css("left",i.offset().left+nodeWidth/2),a.css("top",i.offset().top+nodeWidth/2)}},t.getVerticalProgressPoints=function(){var t=$(".course-progress-node.first"),e=$(".course-progress-node.done:last"),n=$(".course-progress-node:last");return 0==e.length&&(e=t),{first:t,upto:e,last:n}},t.initVerticalBars=function(){if($(".course-progress-node").length>0){$("body").prepend("<div class='vertical-progress-done'></div>"),$("body").prepend("<div class='vertical-progress-todo'></div>");var t=$(".course-progress-node").not(".done").first().parent().next(),e=t.find("a").attr("href");t.find(".box").prepend("<a href='"+e+"' class='button create-button float-right lets-go'>Let's Go!</div>")}},t.initHorizontalBars=function(){$(".progress-list-wrapper").prepend("<div class='progress'></div>")},t.bindProgressBarResize=function(){t.updateProgressBars(),window.setTimeout(t.updateProgressBars,1e3),$(".course-progress-node").length>0&&window.setInterval(t.updateProgressBars,100),$(window).resize(t.updateProgressBars),supportsTransitions()&&t.runBarUpdate()},t.barUpdateCount=0,t.runBarUpdate=function(){t.barUpdateCount++,t.barUpdateCount<100&&(requestAnimationFrame(t.runBarUpdate),t.updateProgressBars())}};progress.initHorizontalBars(),progress.bindProgressBarResize(),progress.initVerticalBars();var search=new function(){var t=this;t.searchTerm="",t.categoryFilter="",t.bindDefinitionSearchField=function(){$(".js-definition-filter").keyup(function(){var t=$(this).val().toLowerCase();$(".definition-block").each(function(){var e=$(this).attr("data-definition-name").toLowerCase(),n=!1;(e.indexOf(t)>=0||t.indexOf(e)>=0)&&(n=!0),n?$(this).parent().show():$(this).parent().hide()})})},t.bindCourseSearchField=function(){$(".js-course-filter").keyup(function(){t.searchTerm=$(this).val().toLowerCase(),t.filterCourses(t.searchTerm,t.categoryFilter)}),$(".js-category-tag").click(function(){"true"!=$(this).attr("data-selected")?(t.categoryFilter=$(this).attr("data-category").toLowerCase(),$(".js-category-tag").each(function(){$(this).css("background-color",$(this).attr("data-bg")),$(this).attr("data-selected","false")}),$(this).css("background-color",$(this).attr("data-bg-selected")),$(this).attr("data-selected","true")):(t.categoryFilter="",$(this).css("background-color",$(this).attr("data-bg")),$(this).attr("data-selected","false")),t.filterCourses(t.searchTerm,t.categoryFilter)})},t.filterCourses=function(t,e){$(".course-block").each(function(){var n=$(this).attr("data-category-name").toLowerCase(),i=$(this).attr("data-course-name").toLowerCase(),o=!1;(i.indexOf(t)>=0||t.indexOf(i)>=0||n.indexOf(t)>=0||t.indexOf(n)>=0)&&(o=!0),-1==n.indexOf(e)&&(o=!1),o?$(this).parent().show():$(this).parent().hide()})}};search.bindCourseSearchField(),search.bindDefinitionSearchField();var sharing=new function(){var t=$("form#addSharedImageForm"),e=this;e.bindSharingImageForm=function(){t.ajaxForm({beforeSubmit:function(){t.find(".errors").text(""),t.find('input[type="submit"]').attr("disabled","disabled")},success:function(e){e.success?e.refresh&&location.reload(!0):appendErrors(e.errors,t,".errors"),t.find('input[type="submit"]').attr("disabled",!1)},error:function(){t.find(".errors").append("Could not share image, try again?"),t.find('input[type="submit"]').attr("disabled",!1)}})},e.bindLikeImage=function(){$(".likes .like-image").click(function(t){var e=$(this);t.preventDefault(),$.get($(this).attr("href"),function(t){t&&t.success&&e.parent().find(".likes-count").text(t.like_count)})})},e.bindImageClick=function(){$("img.shared-image").lazyload({threshold:200,load:learn.lazyLoadHandler})},e.bindPageResize=function(){e.updateLearnGrid(),$(window).resize(e.updateLearnGrid)},e.updateLearnGrid=function(){$(".shared-image-holder").each(function(){$(this).css("height",$(this).css("width"))})},$("#shared_image_shared_image").change(function(){this.files[0].size/1048576>2?t.find(".errors").append("This file is too large (bigger than 2MB), try compressing or resizing it."):t.ajaxSubmit({url:"/upload-image/",type:"post",beforeSubmit:function(){t.find(".errors").text(""),t.find('input[type="submit"]').attr("disabled","disabled")},success:function(e){e.success?($("#shared_image_url").val(e.file),$("#shared_image_preview").attr("src",e.file)):appendErrors(e.errors,t,".errors"),t.find('input[type="submit"]').attr("disabled",!1)},error:function(){t.find(".errors").append("Could not share image, try again?"),t.find('input[type="submit"]').attr("disabled",!1)}})})};sharing.bindImageClick(),sharing.bindSharingImageForm(),sharing.bindPageResize(),sharing.bindLikeImage();var slug=new function(){var t=this;t.bindSlugFields=function(){$(".js-slug").keyup(function(){var t="#"+$(this).attr("data-object")+"_"+$(this).attr("data-target");$(t).val(convertToSlug($(this).val()))})},t.bindLowercaseFields=function(){$(".js-lowercase").keyup(function(){var t="#"+$(this).attr("data-object")+"_"+$(this).attr("data-target");$(t).val(convertToLowercase($(this).val()))})}};slug.bindSlugFields(),slug.bindLowercaseFields(),bindSortableLists(),bindUpload(),$.postWithCsrf=function(t,e,n){e[$("meta[name=csrf-param]").attr("content")]=$("meta[name=csrf-token]").attr("content"),$.post(t,e,n)},String.prototype.trunc=String.prototype.trunc||function(t){return this.length>t?this.substr(0,t-3)+"...":this};